<?xml version="1.0"?>
<openerp>
    <data>
        <!--res.partner-->
        <record model="ir.ui.view" id="view_res_partner_log_form">
            <field name="name">res.partner.form</field>
            <field name="model">res.partner</field>
            <field name="priority" eval="40" />
            <field name="arch" type="xml">
                <form string="String" version="7.0">        
                    <sheet>
                        <field name="image" widget="image" class="oe_left oe_avatar" options="{'preview_image': 'image_medium', 'size': [90, 90]}"/>
		                <div class="oe_title oe_left">
			                <div class="oe_edit_only">
				                <label for="name"/>
				                (                                            
				                <field name="is_company" on_change="onchange_type(is_company)" class="oe_inline"/>
				                <label for="is_company" string="Is company?"/>
				                )                                        
			                </div>
			                <h1>
   				                <field name="name" default_focus="1" placeholder="Nome" required="1" />
			                </h1>
		                </div>
                        <group col="4" colspan="4">                        
                            <field name="log_code" />
                            <notebook colspan="4">
                                <page string="Activity">
                                    <group col="4" colspan="4">                        
                                        <field name="log_activity_ids" nolabel="1" colspan="4" context="{'embedded_partner': True}"/>
                                    </group>    
                                </page>
                                <page string="User">
                                    <group col="4" colspan="4">                        
                                        <field name="log_users_ids" nolabel="1" colspan="4" />
                                    </group>    
                                </page>
                            </notebook>                                 
                        </group>
                    </sheet>        
                </form>
            </field>
        </record>
        <record model="ir.actions.act_window" id="action_res_partner_log">
            <field name="name">Partner</field>
            <field name="res_model">res.partner</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="context">{'default_is_company': True, 'form_view_ref': 'activity_log_base.view_res_partner_log_form'}</field>
            <field name="domain">[('is_company', '=', True)]</field>
        </record>
            
        <!--log.category-->
        <record model="ir.ui.view" id="view_log_category_form">
            <field name="name">log.category.form</field>
            <field name="model">log.category</field>
            <field name="arch" type="xml">
                <form string="Category" version="7.0">        
                    <sheet>
                        <group col="4" colspan="4">
                            <field name="active" />
                            <field name="code" />
                            <field name="name" />
                            <notebook colspan="4">
                                <page string="Activity">
                                    <group col="4" colspan="4">
                                        <separator string="Activity" colspan="4"/>
                                        <field name="activity_ids" nolabel="1" colspan="4" context="{'embedded': True}"/>
                                    </group>    
                                </page>
                                <page string="Note">
                                    <group col="4" colspan="4">
                                        <separator string="Note" colspan="4"/>
                                        <field name="note" nolabel="1" colspan="4" />
                                    </group>    
                                </page>
                            </notebook>
                        </group>
                    </sheet>        
                </form>
            </field>
        </record>
        <record model="ir.ui.view" id="view_log_category_tree">
            <field name="name">log.category.tree</field>
            <field name="model">log.category</field>
            <field name="arch" type="xml">
                <tree string="Category" version="7.0" colors="grey:active==False">        
                    <field name="active" />
                    <field name="code" />
                    <field name="name" />
                </tree>
            </field>
        </record>
        <record model="ir.actions.act_window" id="action_open_log_category">
            <field name="name">Category</field>
            <field name="res_model">log.category</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="view_id" ref="view_log_category_tree"/>
        </record>


        <!--log.activity-->
        <record model="ir.ui.view" id="view_log_activity_tree">
            <field name="name">log.activity.tree</field>
            <field name="model">log.activity</field>
            <field name="arch" type="xml">
                <tree string="Activity" version="7.0" colors="blue:monitor==True">  
                    <field name="active" invisible="1"/>      
                    <field name="monitor" invisible="1"/>
                    <field name="email_alert" />
                    <field name="code" />
                    <field name="name" />
                    <field name="partner_id" invisible="context.get('embedded', False)"/>
                    <field name="category_id" invisible="context.get('embedded', False)"/>
                    <field name="from_date" />
                    <field name="to_date" />
                    <field name="state" />
                </tree>
            </field>
        </record>        
        <record model="ir.ui.view" id="view_log_activity_form">
            <field name="name">log.activity.form</field>
            <field name="model">log.activity</field>
            <field name="arch" type="xml">
                <form string="Activity" version="7.0">        
                    <header>
                        <field name="active" /><!--TODO button-->
                        <field name="monitor" /><!--TODO button-->
                        <field name="state" widget="statusbar" />
                    </header>
                    <sheet>
                        <group col="4" colspan="4">
                            <field name="code" />
                            <field name="name" />
                            <field name="category_id" />
                            <field name="partner_id" domain="[('is_company', '=', True)]" context="{'default_is_company': True}"/>
                            <notebook colspan="4">
                                <page string="Period">
                                    <group col="4" colspan="4">
                                        <field name="from_date" />
                                        <field name="to_date" />

                                        <field name="duration" widget="float_time"/>
                                        <field name="auto_duration" />

                                        <field name="check_duration" />
                                        <newline/>

                                        <field name="duration_warning_range" attrs="{'invisible': [('check_duration','=',False)]}"/>
                                        <field name="duration_error_range" attrs="{'invisible': [('check_duration','=',False)]}"/>
                                    </group>                    
                                </page>
                                <page string="Notification">
                                    <group col="4" colspan="4">
                                        <field name="email_alert" />
                                        <newline/>
                                        <field name="email_error" attrs="{'invisible': [('email_alert','=',False)]}"/>
                                        <field name="email_warning" attrs="{'invisible': [('email_alert','=',False)]}" />
                                    </group>                    
                                </page>
                                <page string="Detail">
                                    <group col="4" colspan="4">
                                        <separator string="Script" colspan="4"/>
                                        <field name="script" nolabel="1" colspan="4"/>
                                        <separator string="Origin" colspan="4"/>
                                        <field name="origin" nolabel="1" colspan="4" />
                                    </group>                    
                                </page>
                                <page string="Note">
                                    <group col="4" colspan="4">
                                        <separator string="Note" colspan="4"/>
                                        <field name="note" nolabel="1" colspan="4" />
                                    </group>                    
                                </page>
                            </notebook>
                        </group>
                    </sheet>        
                </form>
            </field>
        </record>        
        <record model="ir.actions.act_window" id="action_log_activity">
            <field name="name">Activity</field>
            <field name="res_model">log.activity</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="view_id" ref="view_log_activity_tree"/>
            <field name="context">{}</field>
            <field name="domain">[]</field>
        </record>
        
        <!--log.activity.event-->
        <record model="ir.ui.view" id="view_log_activity_event_search">
            <field name="name">log.activity.event.search</field>
            <field name="model">log.activity.event</field>
            <field name="arch" type="xml">
                <search string="Log search" version="7.0">        
                    <field name="activity_id" />
                    <field name="partner_id" filter_domain="[('partner_id','=',self)]"/>

                    <filter name="state_started" string="Started" domain="[('state','=','started')]"/>
                    <filter name="state_correct" string="Correct" domain="[('state','=','correct')]"/>
                    <filter name="state_warning" string="Warning" domain="[('state','=','warning')]"/>
                    <filter name="state_error" string="Error" domain="[('state','=','error')]"/>

                    <filter name="state_error" string="Check list" 
                        domain="[('mark_ok','=',False),('state','in',('warning','error'))]"/>

                    <group expand="0" string="Group By...">
                        <filter name="group_datetime" string="Log period" context="{'group_by': 'datetime'}"/>
                        <filter name="group_start" string="Log start" context="{'group_by': 'start'}"/>
                        <filter name="group_end" string="Log end" context="{'group_by': 'end'}"/>
                        <filter name="group_partner" string="Partner" context="{'group_by': 'partner_id'}"/>
                        <filter name="group_activity" string="Activity" context="{'group_by': 'activity_id'}"/>
                        <filter name="group_state" string="Status" context="{'group_by': 'state'}" />
                    </group>                
                </search>
            </field>
        </record>
        <record model="ir.ui.view" id="view_log_activity_event_form">
            <field name="name">log.activity.event.form</field>
            <field name="model">log.activity.event</field>
            <field name="arch" type="xml">
                <form string="Event" version="7.0">        
                    <header>
                        <field name="state" widget="statusbar" />
                    </header>
                    <sheet>
                        <group col="4" colspan="4">
                            <field name="datetime" />
                            <field name="activity_id" />
                            <field name="partner_id" />
                            <field name="start" />
                            <field name="end" />
                            <field name="duration" widget="float_time"/>
                            <field name="mark_ok" />
                            
                            <notebook colspan="4">
                                <page string="Log">
                                    <group col="6" colspan="4">
                                        <separator string="Info" colspan="2"/>
                                        <separator string="Warning" colspan="2"/>
                                        <separator string="Error" colspan="2"/>
                                        
                                        <field name="log_info" nolabel="1" colspan="2" />
                                        <field name="log_warning" nolabel="1" colspan="2" />
                                        <field name="log_error" nolabel="1" colspan="2" />
                                    </group>
                                </page>
                                <page string="Origin">
                                    <group col="4" colspan="4">
                                        <separator string="Origin" colspan="4"/>
                                        <field name="origin" nolabel="1" colspan="4" />
                                    </group>
                                </page>
                            </notebook>
                        </group>
                    </sheet>        
                </form>
            </field>
        </record>        
        <record model="ir.ui.view" id="view_log_activity_event_tree">
            <field name="name">log.activity.event.tree</field>
            <field name="model">log.activity.event</field>
            <field name="arch" type="xml">
                <tree string="Event" version="7.0" colors="blue:state=='started',green:state=='correct',red:state=='error',orange:state=='warning'">
                    <field name="datetime" />
                    <field name="activity_id" />
                    <field name="partner_id" />
                    <field name="start" />
                    <field name="end" />
                    <field name="duration" />
                    <field name="mark_ok" />
                    <field name="state" />
                </tree>
            </field>
        </record>
        <record model="ir.actions.act_window" id="action_log_activity_event">
            <field name="name">Event log</field>
            <field name="res_model">log.activity.event</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="view_id" ref="view_log_activity_event_tree"/>
            <field name="search_view_id" ref="view_log_activity_event_search" />
            <field name="context">{}</field>
            <field name="domain">[]</field>
        </record>
        <record model="ir.actions.act_window" id="action_log_activity_event_error">
            <field name="name">Event log error</field>
            <field name="res_model">log.activity.event</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="view_id" ref="view_log_activity_event_tree"/>
            <field name="search_view_id" ref="view_log_activity_event_search" />
            <field name="context">{}</field>
            <field name="domain">[('state', 'in', ('warning', 'error')),('mark_ok','=',False)]</field>
        </record>
        
        <menuitem 
            id="menu_log_root" 
            name="Log" 
            sequence="10" 
            />
            <menuitem 
                parent="menu_log_root" 
                id="menu_log_activity" 
                sequence="10" 
                name="Logs"
                />                
                <menuitem 
                    parent="menu_log_activity" 
                    id="menu_activity_log" 
                    action="action_log_activity"
                    sequence="10"
                    />
                <menuitem 
                    parent="menu_log_activity" 
                    id="menu_activity_event_log" 
                    action="action_log_activity_event"
                    sequence="20"
                    />
                <menuitem 
                    parent="menu_log_activity" 
                    id="menu_activity_event_log_error" 
                    action="action_log_activity_event_error"
                    sequence="30"
                    />
                        
            <menuitem 
                parent="menu_log_root" 
                id="menu_log_configuration_root"  
                name="Configuration"
                sequence="90" 
                />
                <menuitem 
                    parent="menu_log_configuration_root" 
                    id="menu_open_configuration_log_partner" 
                    action="action_res_partner_log"
                    sequence="10"
                    />
                <menuitem 
                    parent="menu_log_configuration_root" 
                    id="menu_open_configuration_log_category" 
                    action="action_open_log_category"
                    sequence="20"
                    />
                    
    </data>
</openerp>

